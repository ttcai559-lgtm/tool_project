# 项目命令列表

## 目录
- [BMad 方法命令](#bmad-方法命令)
- [Pytest 测试命令](#pytest-测试命令)

---

## BMad 方法命令

BMad Method 是一个企业级敏捷开发方法框架，提供了从项目启动到实施的完整工作流。

### 核心命令

| 命令 | 说明 | 使用场景 |
|------|------|----------|
| `/bmad-init` | 初始化 BMad 项目 | 在新项目或现有项目中首次使用 BMad 时 |
| `/bmad-status` | 检查工作流状态 | 了解项目当前进度和下一步建议 |
| `/bmad-party` | 启动多代理协作讨论 | 需要多个角色（PM、架构师、开发等）协作讨论时 |
| `/bmad-help` | 显示帮助信息 | 查看所有可用命令列表 |
| `/bmad-quick-start` | 快速入门指南 | 首次使用 BMad 时了解基本流程 |
| `/bmad-docs` | 访问完整文档 | 查看详细的 BMad 文档 |
| `/bmad-list-workflows` | 列出所有可用工作流 | 查看项目中所有可用的工作流程 |
| `/bmad-list-agents` | 列出所有可用代理 | 查看项目中所有可用的 AI 代理角色 |

### 分析阶段（Phase 1 - Analysis）

项目启动阶段，用于需求分析和市场研究。

| 命令 | 说明 | 输出产物 |
|------|------|----------|
| `/bmad-brainstorm` | 项目头脑风暴会话 | 项目构思、目标和关键决策文档 |
| `/bmad-research` | 自适应研究工作流 | 市场分析、技术调研、竞品分析报告 |
| `/bmad-product-brief` | 创建产品简介 | 产品简介文档（Product Brief） |
| `/bmad-domain-research` | 领域特定需求探索 | 领域知识和特定需求文档 |

### 规划阶段（Phase 2 - Planning）

定义产品需求和技术规范。

| 命令 | 说明 | 适用范围 |
|------|------|----------|
| `/bmad-prd` | 创建产品需求文档 | 大型项目，需要详细的功能规划 |
| `/bmad-tech-spec` | 创建技术规范 | 小型项目或快速迭代，偏重技术实现 |
| `/bmad-ux-design` | UX 设计工作流 | 需要用户体验设计的项目 |

### 解决方案阶段（Phase 3 - Solutioning）

架构设计和任务分解。

| 命令 | 说明 | 输出产物 |
|------|------|----------|
| `/bmad-arch` | 架构设计 | 系统架构文档、技术选型 |
| `/bmad-create-epics` | 从 PRD 创建史诗和故事 | 用户故事（User Stories）和史诗（Epics） |
| `/bmad-impl-ready` | 实施准备验证 | 验证所有必要文档和准备工作已完成 |

### 实施阶段（Phase 4 - Implementation）

实际开发和代码实现。

#### Sprint 管理

| 命令 | 说明 | 使用时机 |
|------|------|----------|
| `/bmad-sprint-plan` | Sprint 规划和跟踪 | Sprint 开始时规划任务，过程中跟踪进度 |
| `/bmad-retrospective` | Sprint 回顾 | Sprint 结束时总结经验教训 |
| `/bmad-correct-course` | 课程修正 | 遇到重大变更或偏离计划时 |

#### 故事开发流程

| 命令 | 说明 | 开发流程 |
|------|------|----------|
| `/bmad-create-story` | 创建新用户故事 | 1. 创建故事 |
| `/bmad-story-context` | 组装故事上下文 | 2. 准备开发所需的完整上下文 |
| `/bmad-story-ready` | 标记故事为准备开发 | 3. 确认故事可以开始开发 |
| `/bmad-dev-story` | 开发用户故事 | 4. 实际编码实现 |
| `/bmad-code-review` | 代码审查 | 5. 代码质量检查 |
| `/bmad-story-done` | 标记故事为完成 | 6. 完成并归档 |

### 文档工具

用于项目文档管理。

| 命令 | 说明 | 用途 |
|------|------|------|
| `/bmad-document` | 记录现有项目 | 为棕地项目（已存在的项目）创建文档 |

### 图表生成工具

用于创建各种项目图表。

| 命令 | 说明 | 生成内容 |
|------|------|----------|
| `/bmad-diagram` | 创建系统架构图 | 系统架构图、ERD、UML 图 |
| `/bmad-flowchart` | 创建流程图 | 业务流程图、算法流程图 |
| `/bmad-wireframe` | 创建线框图 | UI 界面线框图 |
| `/bmad-dataflow` | 创建数据流图 | 数据流向和处理流程图 |

### 代理命令（Agent Commands）

BMad 提供多个专业角色的 AI 代理，每个代理都有特定的职责。

| 命令 | 角色 | 职责 |
|------|------|------|
| `/bmad/agent-master` | BMad Master | 主执行器，协调整体流程 |
| `/bmad/agent-pm` | John（产品经理） | 产品规划、需求管理 |
| `/bmad/agent-architect` | Winston（架构师） | 系统架构设计、技术选型 |
| `/bmad/agent-dev` | Amelia（开发者） | 编码实现、技术开发 |
| `/bmad/agent-analyst` | Mary（业务分析师） | 业务分析、需求分析 |
| `/bmad/agent-sm` | Bob（Scrum Master） | 敏捷流程管理、团队协调 |
| `/bmad/agent-tea` | Murat（测试架构师） | 测试策略、质量保证 |
| `/bmad/agent-ux` | Sally（UX 设计师） | 用户体验设计、交互设计 |
| `/bmad/agent-tech-writer` | Paige（技术作家） | 技术文档编写、文档管理 |

---

## 推荐工作流程

### 新项目（绿地项目）完整流程

```
1. /bmad-init              # 初始化项目
2. /bmad-brainstorm        # 头脑风暴
3. /bmad-product-brief     # 创建产品简介
4. /bmad-prd               # 创建产品需求文档（大项目）
   或 /bmad-tech-spec      # 创建技术规范（小项目）
5. /bmad-ux-design         # UX 设计（如需要）
6. /bmad-arch              # 架构设计
7. /bmad-create-epics      # 创建史诗和故事
8. /bmad-impl-ready        # 验证准备就绪
9. /bmad-sprint-plan       # 开始 Sprint
10. /bmad-dev-story        # 开发故事
11. /bmad-code-review      # 审查代码
12. /bmad-retrospective    # Sprint 回顾
```

### 现有项目（棕地项目）接入流程

```
1. /bmad-document          # 记录现有项目
2. /bmad-init              # 初始化 BMad 跟踪
3. /bmad-status            # 检查当前状态
4. 根据需要使用其他工作流
```

### 快速功能开发流程

```
1. /bmad-tech-spec         # 创建快速技术规范
2. /bmad-dev-story         # 直接开发
3. /bmad-code-review       # 审查
```

---

## Pytest 测试命令

本项目使用 Pytest 作为测试框架，以下是常用的测试命令。

### 基本运行命令

```bash
# 运行所有测试
pytest

# 运行指定目录
pytest testcases/

# 运行指定文件
pytest testcases/api/test_user.py

# 运行指定测试类
pytest testcases/api/test_user.py::TestUserLogin

# 运行指定测试方法
pytest testcases/api/test_user.py::TestUserLogin::test_login_success
```

### 输出控制

| 命令 | 说明 | 效果 |
|------|------|------|
| `pytest -v` | 详细输出 | 显示每个测试用例的详细信息 |
| `pytest -s` | 显示 print 输出 | 不捕获标准输出，显示 print 内容 |
| `pytest -vs` | 组合详细输出 | 同时显示详细信息和 print 输出 |
| `pytest -q` | 简洁输出 | 精简输出，只显示关键信息 |
| `pytest --tb=short` | 简短错误信息 | 只显示失败用例的简短回溯 |
| `pytest --tb=line` | 单行错误信息 | 每个失败只显示一行 |
| `pytest --tb=no` | 不显示错误信息 | 不显示回溯信息 |

### 标记运行（Markers）

```bash
# 运行 smoke 测试
pytest -m smoke

# 运行多个标记
pytest -m "smoke or regression"

# 排除某些标记
pytest -m "not slow"

# 查看所有标记
pytest --markers
```

### 失败处理

| 命令 | 说明 | 使用场景 |
|------|------|----------|
| `pytest -x` | 遇到第一个失败就停止 | 快速发现问题 |
| `pytest --maxfail=3` | 遇到 N 个失败停止 | 限制失败数量 |
| `pytest --reruns 2` | 失败重试 2 次 | 处理不稳定的测试 |
| `pytest --lf` | 只运行上次失败的用例 | 修复后快速验证 |
| `pytest --ff` | 先运行上次失败的用例 | 优先验证之前的问题 |
| `pytest --nf` | 先运行新增或修改的测试 | 关注新代码 |

### 并发执行

```bash
# 使用 4 个进程并发
pytest -n 4

# 自动检测 CPU 核心数
pytest -n auto

# 每个测试文件用一个进程
pytest --dist loadfile

# 每个测试类用一个进程
pytest --dist loadscope
```

### 测试报告生成

#### HTML 报告

```bash
# 生成基本 HTML 报告
pytest --html=report.html

# 生成独立的 HTML 报告（包含 CSS）
pytest --html=report.html --self-contained-html
```

#### Allure 报告

```bash
# 生成 Allure 测试结果
pytest --alluredir=./reports/allure-results

# 生成并打开 Allure 报告
allure serve ./reports/allure-results
```

#### JUnit XML 报告

```bash
# 生成 JUnit XML 报告（用于 CI/CD）
pytest --junit-xml=report.xml
```

### 用例收集

```bash
# 只收集用例，不运行
pytest --collect-only

# 显示用例收集信息（精简）
pytest --collect-only -q

# 显示收集的测试 ID
pytest --collect-only --quiet
```

### 代码覆盖率

```bash
# 生成覆盖率报告（HTML）
pytest --cov=apis --cov-report=html

# 显示终端覆盖率报告
pytest --cov=apis --cov-report=term

# 显示缺失的行
pytest --cov=apis --cov-report=term-missing

# 生成 XML 覆盖率报告（用于 CI）
pytest --cov=apis --cov-report=xml

# 组合多种报告
pytest --cov=apis --cov-report=html --cov-report=term-missing
```

### 性能和调试

| 命令 | 说明 | 用途 |
|------|------|------|
| `pytest --durations=10` | 显示最慢的 10 个用例 | 性能优化 |
| `pytest --durations=0` | 显示所有用例的执行时间 | 全面性能分析 |
| `pytest --timeout=60` | 设置测试超时（秒）| 避免测试卡死 |
| `pytest --pdb` | 失败时进入调试器 | 交互式调试 |
| `pytest --trace` | 每个测试开始时进入调试器 | 逐步调试 |
| `pytest -l` | 显示局部变量 | 查看失败时的变量值 |

### 环境和配置

```bash
# 使用自定义配置文件
pytest -c custom_pytest.ini

# 指定环境变量
pytest --env=staging

# 覆盖配置选项
pytest -o log_cli=true -o log_cli_level=DEBUG

# 显示可用的 fixtures
pytest --fixtures

# 显示可用的插件
pytest --version --version
```

### 过滤和选择

```bash
# 按关键字过滤测试
pytest -k "test_login"

# 按关键字排除测试
pytest -k "not test_slow"

# 组合多个关键字
pytest -k "test_login or test_logout"

# 按文件路径过滤
pytest tests/unit/ tests/api/test_user.py
```

---

## 使用 run_tests.py 脚本

本项目提供了 `run_tests.py` 脚本，封装了常用的 Pytest 命令。

### 基本用法

```bash
# 基本运行
python run_tests.py

# 指定环境
python run_tests.py --env=test
python run_tests.py --env=staging
python run_tests.py --env=prod

# 运行指定标记的测试
python run_tests.py -m smoke
python run_tests.py -m regression
python run_tests.py -m "smoke or critical"

# 指定测试路径
python run_tests.py -p testcases/api/test_user.py
python run_tests.py -p testcases/

# 并发运行
python run_tests.py -n 4
python run_tests.py -n auto
```

### 报告生成

```bash
# 生成 Allure 报告
python run_tests.py --allure

# 生成并自动打开 Allure 报告
python run_tests.py --allure --serve

# 生成 HTML 报告
python run_tests.py --html

# 生成覆盖率报告
python run_tests.py --cov
```

### 组合使用

```bash
# 在测试环境运行 smoke 测试，使用 4 个进程，生成 Allure 报告
python run_tests.py --env=test -m smoke -n 4 --allure

# 运行回归测试，失败重试 2 次，生成覆盖率报告
python run_tests.py -m regression --reruns 2 --cov

# 详细输出，显示 print 内容
python run_tests.py -vs
```

---

## CI/CD 集成示例

### Jenkins / GitLab CI

```bash
# 基本 CI 流程
pytest -v -s --html=report.html --alluredir=allure-results

# 带失败重试
pytest -v -s --reruns 2 --html=report.html --alluredir=allure-results

# 并发执行，生成多种报告
pytest -n auto --html=report.html --junit-xml=junit.xml --alluredir=allure-results

# 带覆盖率
pytest -n auto --cov=apis --cov-report=html --cov-report=xml --html=report.html
```

### GitHub Actions 示例

```yaml
- name: Run tests
  run: |
    pytest -v -s \
      --html=report.html \
      --self-contained-html \
      --alluredir=allure-results \
      --junit-xml=junit.xml \
      --cov=apis \
      --cov-report=xml
```

---

## 常见测试场景

### 快速验证

```bash
# 只运行 smoke 测试
pytest -m smoke -v

# 只运行上次失败的测试
pytest --lf -v
```

### 完整回归测试

```bash
# 运行所有测试，并发执行，生成完整报告
pytest -n auto -v --html=report.html --alluredir=allure-results --cov=apis --cov-report=html
```

### 调试特定问题

```bash
# 详细输出，显示 print，遇到第一个失败停止并进入调试器
pytest -vsx --pdb testcases/api/test_user.py
```

### 性能分析

```bash
# 显示最慢的 20 个测试
pytest --durations=20

# 详细的性能分析
pytest -v --durations=0 | sort -k 2 -n
```

---

## 注意事项

### BMad 命令注意事项

1. **首次使用**：在新项目中首次使用 BMad 时，必须先运行 `/bmad-init` 进行初始化
2. **工作流顺序**：建议按照分析 → 规划 → 解决方案 → 实施的顺序使用工作流
3. **文档输出**：所有 BMad 命令会在 `docs/` 目录下生成相应的文档
4. **状态跟踪**：使用 `/bmad-status` 可以随时查看当前项目状态和下一步建议

### Pytest 命令注意事项

1. **插件依赖**：某些命令需要安装相应插件：
   - `--html` 需要 `pytest-html`
   - `--alluredir` 需要 `allure-pytest`
   - `--cov` 需要 `pytest-cov`
   - `-n` 需要 `pytest-xdist`
   - `--reruns` 需要 `pytest-rerunfailures`

2. **并发限制**：使用 `-n` 并发执行时，确保测试用例之间没有依赖关系

3. **报告路径**：生成的报告文件会保存在指定路径，确保目录存在或有创建权限

4. **环境配置**：使用 `--env` 参数时，确保 `config/` 目录下有对应的环境配置文件

---

## 版本信息

- **BMad 版本**: 6.0.0-alpha.12
- **安装日期**: 2025-11-25
- **Pytest 版本**: 请运行 `pytest --version` 查看
- **文档更新日期**: 2025-12-01
